# 🔍 OCR识别功能说明

## 功能概述

Delta Tool 现在支持通过OCR（光学字符识别）自动识别游戏画面中的文字信息：

### 🎯 主要功能

1. **降落地点识别**
   - 游戏开始时自动识别屏幕上方显示的出生点名称
   - 记录真实的中文名称
   - 用于完善战术地图数据

2. **结算画面识别**
   - 自动识别"成功撤离"或"阵亡"状态
   - 提取收益数字（哈夫币）
   - 识别撤离点名称
   - 自动结束游戏会话并保存数据

3. **数据统计**
   - 统计所有识别到的出生点名称
   - 计算识别频率和置信度
   - 导出数据用于优化地图信息

## 📦 安装OCR引擎

### 方法1: 使用安装脚本（推荐）

双击运行 `install_ocr.bat`，选择要安装的引擎：
- **EasyOCR**: 简单易用，支持中英文
- **PaddleOCR**: 中文识别更强

### 方法2: 手动安装

**安装 EasyOCR**:
```bash
pip install easyocr
```

**安装 PaddleOCR**:
```bash
pip install paddlepaddle paddleocr
```

> 💡 **提示**: 只需安装其中一个即可，程序会自动选择已安装的引擎

## 🚀 使用方法

### 1. 启动监控
1. 打开 Delta Tool 应用
2. 进入 "💻 实时监控" 页面
3. 点击 "▶️ 启动监控"

### 2. 开始游戏
1. 启动《三角洲行动》游戏
2. 进入战局
3. 系统会在前30秒自动识别降落地点

### 3. 查看识别结果
在 "💻 实时监控" 页面底部的 "🔍 OCR识别功能" 区域：
- 查看识别状态
- 浏览识别到的出生点统计
- 导出数据为CSV

## 📊 识别效果

### 降落地点识别
**识别时机**: 游戏开始后的前30秒  
**识别区域**: 屏幕上方中央（通常显示出生点的位置）  
**识别示例**:
```
✅ [OCR识别] 出生点: 军营/栏杆 (置信度: 0.89)
  → 推断地图: 大坝
```

### 结算画面识别
**识别时机**: 游戏进行1分钟后，每5秒检查一次  
**识别内容**:
- ✅ 成功撤离 / ❌ 阵亡
- 💰 收益: +500,000 哈夫币
- 🚁 撤离点: 直升机

## 📁 数据存储

所有OCR识别数据保存在:
```
C:\Users\你的用户名\Documents\DeltaTool\
```

### 文件说明

**spawn_names_detected.json** - 出生点识别日志
```json
[
  {
    "timestamp": "2025-12-10T10:30:15.123456",
    "spawn_point": "军营/栏杆",
    "confidence": 0.89,
    "screenshot": "spawn_detection_20251210_103015.png"
  }
]
```

**ocr_detections.json** - 所有OCR识别记录

**spawn_detection_*.png** - 识别时的截图（用于验证）

## 🎯 使用场景

### 1. 完善战术地图
通过识别真实的游戏中文名称，更新战术地图中的出生点命名

### 2. 统计热门降落点
分析哪些出生点被识别最多次，了解玩家习惯

### 3. 自动化数据记录
结合颜色检测和OCR识别，完全自动化记录游戏数据

## ⚙️ 配置选项

### 识别参数
在 `game_monitor.py` 中可调整：

```python
self.spawn_detection_duration = 30  # 前30秒检测出生点
self.settlement_check_interval = 5  # 每5秒检查结算画面
```

### 置信度阈值
在 `game_ocr.py` 中调整：

```python
if result["confidence"] > 0.6:  # 置信度阈值
    # 接受识别结果
```

## 🔧 故障排除

### 问题1: OCR引擎加载失败
**原因**: 未安装OCR库  
**解决**: 运行 `install_ocr.bat` 或手动安装

### 问题2: 识别不到文字
**可能原因**:
- 游戏分辨率太低
- 文字显示时间太短
- 游戏UI被遮挡

**解决方案**:
1. 提高游戏分辨率（推荐1920x1080或更高）
2. 调整 `spawn_detection_duration` 延长检测时间
3. 确保游戏窗口化运行

### 问题3: 识别结果不准确
**解决方案**:
1. 切换OCR引擎（EasyOCR ↔ PaddleOCR）
2. 降低置信度阈值
3. 检查保存的截图，确认文字清晰可见

## 💡 最佳实践

1. **游戏设置**
   - 分辨率: 1920x1080 或更高
   - 画质: 高或极高
   - 显示模式: 窗口化或无边框窗口

2. **监控设置**
   - 提前启动监控（进入游戏前）
   - 确保游戏窗口在主屏幕
   - 避免游戏窗口被其他窗口遮挡

3. **数据验证**
   - 定期查看识别统计
   - 检查保存的截图
   - 导出CSV进行分析

## 📈 数据分析

### 导出出生点统计
1. 进入 "💻 实时监控" 页面
2. 滚动到 "🔍 OCR识别功能" 区域
3. 点击 "📥 导出出生点数据为CSV"
4. 使用Excel或其他工具分析

### CSV文件格式
```csv
出生点名称,识别次数,平均置信度,首次识别
军营/栏杆,15,89.50%,2025-12-10
水泥厂/后山,8,92.30%,2025-12-10
济舍/中心,5,87.60%,2025-12-10
```

## 🔄 更新地图数据

识别到的出生点名称可以用于更新 `app.py` 中的地图数据：

```python
MAPS_DATA = {
    "大坝": {
        "spawn_points": {
            "优势方": [
                {
                    "name": "军营/栏杆",  # ← 使用OCR识别到的真实名称
                    "desc": "离主楼最近，TO出生点",
                    # ...
                }
            ]
        }
    }
}
```

## 🎓 技术原理

### OCR引擎对比

| 特性 | EasyOCR | PaddleOCR |
|------|---------|-----------|
| 安装难度 | ⭐⭐ | ⭐⭐⭐ |
| 中文识别 | ⭐⭐⭐⭐ | ⭐⭐⭐⭐⭐ |
| 速度 | ⭐⭐⭐ | ⭐⭐⭐⭐ |
| 内存占用 | 中等 | 较高 |
| GPU加速 | 支持 | 支持 |

### 识别流程

```
屏幕捕获 → 图像预处理 → OCR识别 → 关键词匹配 → 数据记录
    ↓           ↓            ↓           ↓           ↓
   mss      灰度化/增强   EasyOCR    正则提取      JSON
```

## 🆘 获取帮助

- **GitHub Issues**: https://github.com/liu474751-tech/delta-tool/issues
- **查看日志**: `C:\Users\你的用户名\Documents\DeltaTool\`
- **检查截图**: 验证识别区域是否正确

---

**🎮 祝你游戏愉快，识别准确！**
